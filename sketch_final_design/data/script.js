function onRequest(e,t){var n=new XMLHttpRequest;n.addEventListener("load",function(){t(JSON.parse(this.responseText))}),n.open("GET",e),n.send()}function getMeasurementValues(){const e={temperature:{current:{value:(10+20*Math.random()).toFixed(1),timestamp:"09/06/2021 - 17:51:33"},means:[{value:(10+20*Math.random()).toFixed(1),timestamp:"09/06/2021 - 17:51:08"},{value:(10+20*Math.random()).toFixed(1),timestamp:"09/06/2021 - 17:50:08"},{value:(10+20*Math.random()).toFixed(1),timestamp:"09/06/2021 - 17:49:08"}],recordMax:{value:(30+5*Math.random()).toFixed(1),timestamp:"09/06/2021 - 17:46:38"},recordMin:{value:(5+5*Math.random()).toFixed(1),timestamp:"08/06/2021 - 17:46:38"}},humidity:{current:{value:(30+30*Math.random()).toFixed(1),timestamp:"09/06/2021 - 17:51:33"},means:[{value:(30+30*Math.random()).toFixed(1),timestamp:"09/06/2021 - 17:51:08"},{value:(30+30*Math.random()).toFixed(1),timestamp:"09/06/2021 - 17:50:08"},{value:(30+30*Math.random()).toFixed(1),timestamp:"09/06/2021 - 17:49:08"}],recordMax:{value:(60+10*Math.random()).toFixed(1),timestamp:"09/06/2021 - 17:46:38"},recordMin:{value:(15+15*Math.random()).toFixed(1),timestamp:"08/06/2021 - 17:46:38"}}};return new Promise((t,n)=>{setTimeout(()=>{t(e)},1500)})}function getAllFilesFromStorage(){const e=["logs/alarms.log","logs/measures.log","logs/records.log","logs/wifi.log"];return new Promise((t,n)=>{setTimeout(()=>{t(e)},2e3)})}function getFileFromStorage(e){return new Promise((e,t)=>{onRequest("/api/test",function(t){e(t["test-1"])})})}async function deleteFlash(){const e={success:!0};return new Promise((t,n)=>{setTimeout(()=>{t(e)},4e3)})}const endpoints={getMeasurementValues:getMeasurementValues,getAllFilesFromStorage:getAllFilesFromStorage,getFileFromStorage:getFileFromStorage,deleteFlash:deleteFlash};function renderLoader(e){const t=document.createElement("div");return t.classList.add("loader"),t.classList.add(`loader-${e}`),t}let currentInterval=void 0,isFirstCall=!0,isAJAXCallInProgress=!1;async function renderMeasurementValues(){if(!isAJAXCallInProgress){let e;isAJAXCallInProgress=!0,isFirstCall?((e=document.getElementsByClassName("content_info"))[0].appendChild(renderLoader("large")),e[1].appendChild(renderLoader("large"))):((e=document.getElementsByClassName("loader_current"))[0].appendChild(renderLoader("small")),e[1].appendChild(renderLoader("small")));const t=await endpoints.getMeasurementValues();if(isFirstCall){for(let t=0;t<e.length;t++){e[t].classList.remove("content_info--hide-measures"),e[t].getElementsByClassName("loader")[0].remove()}isFirstCall=!1}else e[0].innerHTML="",e[1].innerHTML="";isAJAXCallInProgress=!1,renderTabMeasurements(t.temperature,"temp"),renderTabMeasurements(t.humidity,"humidity")}}function renderTabMeasurements(e,t){if(document.getElementById(`measure_${t}_current`).innerHTML=e.current.value,document.getElementById(`measure_${t}_current_timestamp`).innerHTML=e.current.timestamp,e.means&&e.means.forEach((e,n)=>{document.getElementById(`measure_${t}_mean${n}`).innerHTML=e.value,document.getElementById(`measure_${t}_mean${n}_timestamp`).innerHTML=e.timestamp}),e.recordMax){document.getElementById(`measure_${t}_max`).innerHTML=e.recordMax.value,document.getElementById(`measure_${t}_max_timestamp`).innerHTML=e.recordMax.timestamp}if(e.recordMin){document.getElementById(`measure_${t}_min`).innerHTML=e.recordMin.value,document.getElementById(`measure_${t}_min_timestamp`).innerHTML=e.recordMin.timestamp}}async function renderMeasurementConfig(){currentInterval=5}let poolingIntervalID=void 0;function defineMeasurementPooling(){poolingIntervalID=setInterval(renderMeasurementValues,1e3*currentInterval)}function onUpdateCurrentInterval(){currentInterval=Math.floor(10*Math.random()),clearInterval(poolingIntervalID),defineMeasurementPooling()}renderMeasurementValues(),renderMeasurementConfig(),defineMeasurementPooling();const fileIcon='\n    <svg height="18px" viewBox="0 0 24 24" width="18px" fill="#004">\n        <path d="M0 0h24v24H0V0z" fill="none"/>\n        <path d="M8 16h8v2H8zm0-4h8v2H8zm6-10H6c-1.1 0-2 .9-2 2v16c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/>\n    </svg>\n';async function onFetchStorageFiles(){const e=document.getElementById("storage_nav_list");e.appendChild(renderLoader("medium"));const t=await endpoints.getAllFilesFromStorage();e.innerHTML="",t.forEach(t=>{const n=document.createElement("li");n.classList.add("storage_nav_list_el"),n.setAttribute("name",t),n.innerHTML=fileIcon+t,n.addEventListener("click",onFetchFileContent),e.appendChild(n)})}async function onFetchFileContent(e){const t=e.currentTarget;if(!t.classList.contains("storage_nav_list_el--selected")){const e=document.getElementById("storage_nav_list");for(let t=0;t<e.children.length;t++)e.children[t].classList.remove("storage_nav_list_el--selected");t.classList.add("storage_nav_list_el--selected");const n=document.getElementById("storage_display");n.innerHTML="",n.appendChild(renderLoader("medium")),n.classList.add("storage_display--no-file");const a=t.getAttribute("name"),r=await endpoints.getFileFromStorage(a);n.innerHTML="",n.classList.remove("storage_display--no-file"),n.innerHTML=r}}function onMountStorage(){const e=document.getElementById("storage_display");e.innerHTML="Select a file to view its contents",e.classList.add("storage_display--no-file"),document.getElementById("storage_nav_list").innerHTML="",onFetchStorageFiles()}async function onStorageDelete(){if(confirm("Are you sure you want to delete the entire flash?")){const e=document.getElementById("storage_nav_list");e.appendChild(renderLoader("medium")),await endpoints.deleteFlash(),e.innerHTML="",await onFetchStorageFiles()}}const storageDeleteEl=document.getElementById("storage_delete");storageDeleteEl.addEventListener("click",onStorageDelete);const localStorage=window.localStorage,LOCAL_STORAGE_KEY_TAB="WEATHER_STATION_TAB",tabButtons={temperature:document.querySelector("[data-tab-id=temperature]"),humidity:document.querySelector("[data-tab-id=humidity]"),storage:document.querySelector("[data-tab-id=storage]")},tabContents={temperature:document.querySelector("#content_temperature"),humidity:document.querySelector("#content_humidity"),storage:document.querySelector("#content_storage")};function onMountTab(e){switch(e){case"storage":onMountStorage()}}function setTab(e){Object.keys(tabContents).forEach(t=>{t===e?(tabContents[t].classList.remove("content--hidden"),tabButtons[t].classList.add("container_tabs_el--selected")):(tabContents[t].classList.add("content--hidden"),tabButtons[t].classList.remove("container_tabs_el--selected"))}),localStorage.setItem(LOCAL_STORAGE_KEY_TAB,e),onMountTab(e)}function onInit(){let e=localStorage.getItem(LOCAL_STORAGE_KEY_TAB);null===e&&(e="temperature"),setTab(e)}tabButtons.temperature.onclick=function(){setTab("temperature")},tabButtons.humidity.onclick=function(){setTab("humidity")},tabButtons.storage.onclick=function(){setTab("storage")},onInit();